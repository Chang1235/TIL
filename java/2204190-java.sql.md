# 1. **DBMS와 SQL**

**1) DBMS(Database Management System)**

데이터를 안전하고 효과적으로 저장하고 관리하기 위해 DBMS를 사용한다.

가장 널리 알려진 DBMS로는 오라클에서 만든 Oracle과 MySQL이 있다.

# 2. **SQL(Structured Query Language)**

SQL은 DBMS가 읽고 처리할 수 있는 독립적인 언어다.

DBMS와 대화하기 위해서는 이 SQL을 학습해야 한다.

**1) SQL 종류**

[제목 없음](https://www.notion.so/da654cb0207346d4b15273bfff9fa1f2)

**2) DDL(Data Definition Language)**

DDL은 사전적 의미 그대로 데이터가 저장되는 공간을 정의하는 언어다.

```sql
CREATE TABLE STUDENT {
STUDENT_NO     VARCHAR(10)     PRIMARY KEY,
NAME              VARCHAR(50)     NOT NULL,
SCORE              NUMBER(3),
MAJOR             VARCHAR(100)    NOT NULL
);
```

테이블에 포함될 컬럼은 다음과 같은 구조로 등록한다.

```sql
컬럼이름 데이터타입(데이터크기) 제약조건
```

**3) DML(Data Manipulation Language)**

**(1) 데이터 등록** 

```sql
INSERT INTO 테이블이름(컬럼목록) VALUES(값목록);
```

<aside>
💡 **INSERT 구문에서의 주의사항

1. 칼럼목록과 값목록의 개수가 반드시 일치해야한다.
2. 칼럼목록과 설정되는 값목록의 타입도 일치해야한다.
3. 숫자데이터는 그냥 설정해도 되지만 문자 데이터는 반드시 홑따옴표(’)로 감싸야 한다.**

</aside>

> 모든 칼럼에 값을 입력하는 경우 컬럼목록은 생략할 수 있다.
> 

**(2) 데이터 수정**

```sql
UPDATE 테이블이름 SET 컬럼이름 = 수정값, 컬럼이름 = 수정값;
```

<aside>
💡 **주의 사항

1. 수정할 칼럼이 여러 개 인 경우 콤마(,)를 통해 구분하며, 마지막 칼럼뒤에는 콤마를 찍지 않는다.
2. 특정한 값만 변경하기 위해서는 WHERE 조건을 추가해야한다.**

</aside>

**(3) 데이터 삭제**

```sql
DELETE 테이블이름;
```

<aside>
💡 **주의사항

1. DELETE도 UPDATE와 마찬가지로 WHERE 조건을 사용하지 않으면 지정된 테이블의 모든 데이터가 삭제된다**

</aside>

**4) DQL(Data Query Language)**

테이블에 저장된 데이터를 검색하기 위해서는 SELECT문을 사용하며 쿼리(Query)라고 한다.

**(1) 쿼리 기초**

```sql
SELECT 컬럼이름, 컬럼이름, …
FROM 테이블이름
WEHRE 제약조건;
```

# 3. JDBC(Java Databas Connectivity)

**1) JDBC 개념**

JDBC API가 제공하는 인터페이스를 구현(implements)한 클래스를 JDBC 드라이버라고 한다.
JDBC 드라이버는 jar형태의 압축파일로 제공되며, DBMS를 제공하는 회사의 홈페이지에서 다운로드할 수 있다

**2) JDBC 프로그램 절차**

**(1) 1단계 : 드라이버(Driver) 객체 생성 및 등록**

**(2) 2단계 : 커넥션(Connection) 연결**

**(3) 3단계 : PreparedStatement 생성**

**(4) 4단계 : SQL 전송**

**(5) 5단계 : 연결 해제**

```java
package chapter12;

import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.PreparedStatement;
import java.sql.SQLException;

import org.h2.Driver;

public class InsertTest {

	public static void main(String[] args) {
		Connection conn = null ;
		PreparedStatement stmt = null;
		
		try {
			// 1단계 : 드라이버 객체 로딩
			DriverManager.registerDriver(new Driver());
			
			// 2단계 : H2와 커넥션(고속도로) 연결
			conn = DriverManager.getConnection("jdbc:h2:tcp://localhost/~/test", "sa", "");
			if(conn != null) {
				System.out.println("커넥션 객체의 정보: " + conn.toString());
			}
			
			// 3단계 : 스테이트먼트(고속버스) 생성   (?로 체크하면 성능향상에 도움이 된다)
			String sql = "insert into student(student_no, name, score, major)"
			+  "values(?, ?, ?, ?)";
			
			stmt = conn.prepareStatement(sql);
			
			// SQL 파라미터(?)에 값 설정
			stmt.setString(1, "STD-000015");
			stmt.setString(2, "");
			stmt.setInt(3, 98);
			stmt.setString(4, "컴퓨터공학");
			
			// 4 단계 : SQL 전송      
			int count = stmt.executeUpdate();
			System.out.println(count + "건의 데이터가 처리되었습니다.");
			
			
		} catch (SQLException e) {
			// 어느 클래스의 어느 메소드에서 예외가 발생했는지 추적해서 그 위치를 콘솔에 출력한다.
			e.printStackTrace();
		}finally {
			//데이터베이스 연동이 끝나면 프로그램이 종료되기 전에 반드시 커넥션을 끊어야 한다.
			// 따로 try 하는 이유: 고속버스를 제거하다가 오류가 나면 고속도로는 제거가 안되기 때문에.
			try {
				stmt.close(); // 고속버스 제거
			} catch (SQLException e) {
				e.printStackTrace();
			}
			try {
				conn.close(); // 고속도로 제거
			} catch (SQLException e) {
				e.printStackTrace();
			}
			
			System.out.println("프로그램 종료");
		}
	}

}
```

**3) JDBC를 위한 Utility 사용**

3 단계를 제외하곤 겹치는 부분이 많기 때문에 코드를 간결화한다.

**(1) JDBC Utility 클래스 작성**

```java
import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.PreparedStatement;
import java.sql.SQLException;

public class JDBCUtil {
	
	public static Connection getConnection() {
		Connection conn = null;
		try {
			// JDBC 1단계 : 드라이버 객체 로딩			
			DriverManager.registerDriver(new org.h2.Driver());
			
			// JDBC 2단계 : 커넥션 연결
			String jdbcUrl = "jdbc:h2:tcp://localhost/~/test";
			conn = DriverManager.getConnection(jdbcUrl, "sa", "");
		} catch (SQLException e) {
			e.printStackTrace();
		}
		return conn;
	}
	
	public static void close(PreparedStatement stmt, Connection conn) {
		// JDBC 5단계 : 연결 해제
		try {
			stmt.close();
		} catch (SQLException e) {
			e.printStackTrace();
		}
		
		try {
			conn.close();
		} catch (SQLException e) {
			e.printStackTrace();
		}
	}
}
```

**(2) JDBCUtil을 이용한 INSERT**

```java
package chapter12;

import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.PreparedStatement;
import java.sql.SQLException;

import org.h2.Driver;

public class InsertTest {

	public static void main(String[] args) {
		Connection conn = null ;
		PreparedStatement stmt = null;
		
		try {
			conn = JDBCUtil.getConnection()		;
			// 3단계 : 스테이트먼트(고속버스) 생성   (?로 체크하면 성능향상에 도움이 된다)
			String sql = "insert into student(student_no, name, score, major)"
			+  "values(?, ?, ?, ?)";
			
			stmt = conn.prepareStatement(sql);
			
			// SQL 파라미터(?)에 값 설정
			stmt.setString(1, "STD-000015");
			stmt.setString(2, "채규태");
			stmt.setInt(3, 98);
			stmt.setString(4, "컴퓨터공학");
			
			// 4 단계 : SQL 전송      
			int count = stmt.executeUpdate();
			System.out.println(count + "건의 데이터가 처리되었습니다.");
			
			
		} catch (SQLException e) {
			// 어느 클래스의 어느 메소드에서 예외가 발생했는지 추적해서 그 위치를 콘솔에 출력한다.
			e.printStackTrace();
		}finally {
			JDBCUtil.close(stmt, conn);
			System.out.println("프로그램 종료");
		}
	}

}
```

**4) 데이터 조회 (SELECT)**

자바 프로그램에서 데이터베이스가 조회한 SELECT 결과를 받기 위해서는 ResultSet이라는 새로운 인터페이스를 사용해야 한다. ResultSet이 들어가게 close 메서드를 오버로딩한다.

```java
import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;

public class JDBCUtil {
	
	public static Connection getConnection() {
		~ 생략 ~
	}
	
	public static void close(PreparedStatement stmt, Connection conn) {
		~ 생략 ~
	}
	
	public static void close(ResultSet rs, PreparedStatement stmt, 
	Connection conn) {
		// JDBC 5단계 : 연결 해제
		try {
			rs.close();
		} catch (SQLException e) {
			e.printStackTrace();
		}
		
		try {
			stmt.close();
		} catch (SQLException e) {
			e.printStackTrace();
		}
		
		try {
			conn.close();
		} catch (SQLException e) {
			e.printStackTrace();
		}
	}
}
```

```java
import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;

public class SelectTest1 {

	public static void main(String[] args) {
		// JDBC 관련 변수 
		Connection conn = null;
		PreparedStatement stmt = null;
		ResultSet rs = null;
		
		try {
			conn = JDBCUtil.getConnection();
			
			// JDBC 3단계 : Statement 생성
			String sql = "select * from student";
			stmt = conn.prepareStatement(sql);
			
			// JDBC 4단계 : SQL 전송
			rs = stmt.executeQuery();
			
			// JDBC 5단계 : 조회 결과 사용
			System.out.println("[ STUDENT 목록 ]");
			rs.next();
			System.out.print(rs.getString("STUDENT_NO") + " : ");
			System.out.print(rs.getString("NAME") + " : ");
			System.out.print(rs.getInt("SCORE") + " : ");
			System.out.println(rs.getString("MAJOR"));

		} catch (SQLException e) {
			e.printStackTrace();
		} finally {
			JDBCUtil.close(rs, stmt, conn);
		}
	}
}
```

# 4. **DAO(Data Access Object) 패턴 적용**

JDBC 프로그램은 절차가 너무 장황하고 복잡하기 때문에 비즈니스 로직이나 알고리즘에 집중하기가 어렵게 만든다. 이를 간략하게 만들기위한 패턴이 DAO 패턴이다.

**1) DAO 클래스**

```java
import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;

public class StudentDAO {
	// JDBC 관련 변수 
	private Connection conn = null;
	private PreparedStatement stmt = null;
	private ResultSet rs = null;
	
	// STUDENT 테이블 관련 SQL 명령어
	private String STUDENT_LIST = "select * from student";
	
	// STUDENT 테이블 관련 CRUD 메소드
	// 학생 목록 조회
	public void getStudentList() {
		try {
			conn = JDBCUtil.getConnection();
			stmt = conn.prepareStatement(STUDENT_LIST);
			rs = stmt.executeQuery();
			System.out.println("[ STUDENT 목록 ]");
			while(rs.next()) {
				System.out.print(rs.getString("STUDENT_NO") + " : ");
				System.out.print(rs.getString("NAME") + " : ");
				System.out.print(rs.getInt("SCORE") + " : ");
				System.out.println(rs.getString("MAJOR"));
			}
		} catch (SQLException e) {
			e.printStackTrace();
		} finally {
			JDBCUtil.close(rs, stmt, conn);
		}
	}
}
```

이제 작성된 StudentDAO 클래스를 이용하여 학생 목록을 조회하는 SelectTest.java 파일을 다음과 같이 수정하고 실행 결과를 확인한다

```java
public class SelectTest3 {

	public static void main(String[] args) {
		// 1. StudentDAO 객체를 생성한다.
		StudentDAO dao = new StudentDAO();
		
		// 2. 목록을 조회한다. 
		dao.getStudentList();
	}
}
```

말도 안되게 가벼워진 코드를 볼 수있다. 

이와 같이 INSERT,DELETE, UPDATE도 진행해 주면 된다.
